<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MTA Asset Maintenance</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; transform: translateY(10px); }
        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
        .card-hover { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1); }
        .input-box { width: 100%; padding: 0.75rem 1rem; border: 1px solid #e5e7eb; border-radius: 0.75rem; outline: none; transition: all 0.2s; background: #ffffff; color: #1f2937; }
        .input-box:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .input-box:disabled { background-color: #f9fafb; color: #9ca3af; cursor: not-allowed; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem 1rem; border-radius: 0.75rem; color: #6b7280; font-weight: 500; transition: all 0.2s; cursor: pointer; }
        .nav-item:hover { background-color: #f3f4f6; color: #111827; }
        .nav-item.active { background-color: #eff6ff; color: #2563eb; font-weight: 600; }
        .mobile-nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.25rem; font-size: 0.75rem; color: #9ca3af; padding: 0.5rem; transition: all 0.2s; }
        .mobile-nav-item.active { color: #2563eb; }
    </style>
</head>
<body class="text-gray-800 h-screen overflow-hidden flex flex-col md:flex-row">
    <div id="root" class="w-full h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ***************************************************************
        // üî¥üî¥üî¥ ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡πâ‡∏≤‡∏á‡∏•‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ ‡πÅ‡∏•‡πâ‡∏ß‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì üî¥üî¥üî¥
        const API_URL = "https://script.google.com/macros/s/AKfycbxrg3L1Kvzbjh5U0WlFve8ExsGYcC8YTte2qB8Rs5Ckkza4aDjQ4QRFpCtz599s1NdE/exec"; 
        // ***************************************************************

        // --- Icons ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{path}</svg>
        );
        const Icons = {
            Dashboard: <><rect x="3" y="3" width="7" height="9" rx="1"></rect><rect x="14" y="3" width="7" height="5" rx="1"></rect><rect x="14" y="12" width="7" height="9" rx="1"></rect><rect x="3" y="16" width="7" height="5" rx="1"></rect></>,
            Assets: <><path d="M2 12h20"></path><path d="M7 12v5a3 3 0 0 0 6 0v-5"></path><path d="M8 7V5a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><path d="M12 12V7"></path></>,
            Add: <><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></>,
            Refresh: <><path d="M23 4v6h-6"></path><path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path></>,
            Search: <><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></>,
            ArrowLeft: <><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></>,
            Image: <><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></>,
            File: <><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></>,
            Close: <><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></>,
            Building: <><rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect><line x1="9" y1="22" x2="9" y2="22.01"></line><line x1="15" y1="22" x2="15" y2="22.01"></line><line x1="12" y1="22" x2="12" y2="22.01"></line><line x1="12" y1="2" x2="12" y2="22"></line><line x1="4" y1="10" x2="20" y2="10"></line><line x1="4" y1="16" x2="20" y2="16"></line></>,
            Wrench: <><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path></>,
            Trash: <><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></>,
            Loader: <><path d="M21 12a9 9 0 1 1-6.219-8.56"/></>
        };

        const fileToBase64 = (file) => new Promise((resolve, reject) => {
            if (file.size > 5 * 1024 * 1024) return alert("‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5MB");
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        // --- Components Defined OUTSIDE App to prevent ReferenceError ---
        const LoadingOverlay = ({ text }) => (
            <div className="fixed inset-0 bg-white/80 z-[60] flex flex-col items-center justify-center fade-in backdrop-blur-sm">
                <div className="animate-spin text-blue-600 mb-4"><Icon path={Icons.Loader} size={48} /></div>
                <p className="text-slate-600 font-bold text-lg">{text}</p>
            </div>
        );

        function App() {
            const [view, setView] = useState('dashboard');
            const [data, setData] = useState({ assets: [], departments: [] });
            const [loading, setLoading] = useState(false);
            const [submitting, setSubmitting] = useState(false);
            const [selectedDept, setSelectedDept] = useState(null);
            const [selectedAsset, setSelectedAsset] = useState(null);
            const [showDeptModal, setShowDeptModal] = useState(false);

            useEffect(() => { 
                if (API_URL.includes("URL_FROM")) {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡∏¥‡∏á‡∏Å‡πå API_URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö!");
                } else {
                    fetchData(); 
                }
            }, []);

            const fetchData = async () => {
                setLoading(true);
                try {
                    const res = await fetch(API_URL);
                    const json = await res.json();
                    if(json.assets) setData({ assets: json.assets, departments: json.departments || [] });
                } catch (err) { console.error("Fetch Error:", err); }
                finally { setLoading(false); }
            };

            const postData = async (payload) => {
                setSubmitting(true);
                try {
                    await fetch(API_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    setTimeout(() => {
                        fetchData();
                        setSubmitting(false);
                        if(payload.action === 'save_asset') { setView('assets'); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }
                        if(payload.action === 'save_log') alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
                        if(payload.action === 'save_dept') { setShowDeptModal(false); alert('‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }
                        if(payload.action.includes('delete')) { setView('assets'); alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'); }
                    }, 4000);
                } catch (err) {
                    alert("Error: " + err.message);
                    setSubmitting(false);
                }
            };

            // --- Sub-Components ---
            const Sidebar = () => (
                <div className="hidden md:flex flex-col w-72 bg-white border-r border-gray-200 h-full p-6 shadow-sm z-20">
                    <div className="flex items-center gap-3 mb-10 text-blue-600">
                        <div className="bg-blue-50 p-2.5 rounded-xl"><Icon path={Icons.Wrench} size={28}/></div>
                        <div><h1 className="font-bold text-xl tracking-tight text-gray-900">MTA Service</h1><p className="text-xs text-gray-500 font-medium">Asset Management</p></div>
                    </div>
                    <nav className="flex-1 space-y-2">
                        <div onClick={() => setView('dashboard')} className={`nav-item ${view === 'dashboard' ? 'active' : ''}`}><Icon path={Icons.Dashboard} size={20}/> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</div>
                        <div onClick={() => setView('departments')} className={`nav-item ${['departments', 'assets', 'detail', 'add_asset'].includes(view) ? 'active' : ''}`}><Icon path={Icons.Building} size={20}/> ‡πÅ‡∏ú‡∏ô‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div>
                    </nav>
                    <div className="mt-auto pt-6 border-t border-gray-100"><div onClick={fetchData} className="nav-item hover:bg-gray-50 text-gray-500"><Icon path={Icons.Refresh} size={20}/> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div></div>
                </div>
            );

            const MobileNav = () => (
                <div className="md:hidden fixed bottom-0 w-full bg-white border-t border-gray-200 flex justify-around py-2 px-2 z-50 pb-safe shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
                    <button onClick={() => setView('dashboard')} className={`mobile-nav-item ${view === 'dashboard' ? 'active' : ''}`}><Icon path={Icons.Dashboard} size={24}/><span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span></button>
                    <button onClick={() => setView('departments')} className={`mobile-nav-item ${['departments', 'assets', 'detail'].includes(view) ? 'active' : ''}`}><Icon path={Icons.Building} size={24}/><span>‡πÅ‡∏ú‡∏ô‡∏Å</span></button>
                    <div className="relative -top-6"><button onClick={() => setView('add_asset')} className="bg-blue-600 text-white p-4 rounded-full shadow-lg shadow-blue-600/30 transform active:scale-95 transition border-4 border-gray-50"><Icon path={Icons.Add} size={28}/></button></div>
                    <button onClick={fetchData} className="mobile-nav-item"><Icon path={Icons.Refresh} size={24}/><span>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</span></button>
                </div>
            );

            const DashboardView = () => {
                const totalAssets = data.assets.length;
                const repairing = data.assets.filter(a => a.status === '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°').length;
                const active = totalAssets - repairing;
                return (
                    <div className="p-6 md:p-10 w-full max-w-7xl mx-auto space-y-8 fade-in pb-24 md:pb-10">
                        <div className="flex justify-between items-end"><div><h2 className="text-3xl font-bold text-gray-800">Dashboard</h2><p className="text-gray-500 mt-1">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p></div><button onClick={() => setView('add_asset')} className="hidden md:flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-semibold shadow-lg shadow-blue-200 transition active:scale-95"><Icon path={Icons.Add} size={20}/> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</button></div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-5 card-hover"><div className="p-4 bg-blue-50 text-blue-600 rounded-2xl"><Icon path={Icons.Building} size={32}/></div><div><p className="text-gray-400 text-xs font-bold uppercase tracking-wider">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p><p className="text-3xl font-bold text-gray-800 mt-1">{totalAssets}</p></div></div>
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-5 card-hover"><div className="p-4 bg-orange-50 text-orange-600 rounded-2xl"><Icon path={Icons.Wrench} size={32}/></div><div><p className="text-gray-400 text-xs font-bold uppercase tracking-wider">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</p><p className="text-3xl font-bold text-orange-600 mt-1">{repairing}</p></div></div>
                            <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 flex items-center gap-5 card-hover"><div className="p-4 bg-green-50 text-green-600 rounded-2xl"><Icon path={Icons.Assets} size={32}/></div><div><p className="text-gray-400 text-xs font-bold uppercase tracking-wider">‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥</p><p className="text-3xl font-bold text-green-600 mt-1">{active}</p></div></div>
                        </div>
                    </div>
                );
            };

            const DepartmentView = () => {
                const [newDept, setNewDept] = useState({ name: '', code: '' });
                return (
                    <div className="p-6 md:p-10 w-full max-w-7xl mx-auto h-full flex flex-col pb-24 md:pb-10 fade-in">
                        <div className="flex justify-between items-center mb-8"><div><h2 className="text-2xl md:text-3xl font-bold text-gray-800">‡πÅ‡∏ú‡∏ô‡∏Å (Departments)</h2><p className="text-gray-500 text-sm mt-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô</p></div><button onClick={() => setShowDeptModal(true)} className="bg-white border border-gray-200 text-gray-600 hover:text-blue-600 hover:border-blue-300 px-4 py-2 rounded-xl text-sm font-bold flex gap-2 shadow-sm transition items-center"><Icon path={Icons.Add} size={18}/> <span className="hidden sm:inline">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</span></button></div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto pb-10">
                            {data.departments.map(dept => (
                                <div key={dept.name} onClick={() => { setSelectedDept(dept.name); setView('assets'); }} className="bg-white p-6 rounded-2xl border border-gray-100 shadow-sm flex flex-col items-center justify-center cursor-pointer card-hover gap-3 h-48 relative group"><div className="absolute top-3 right-3 text-[10px] font-mono font-bold text-gray-400 bg-gray-50 px-2 py-1 rounded border border-gray-100 group-hover:bg-blue-50 group-hover:text-blue-500 transition">{dept.code}</div><div className="bg-blue-50 text-blue-500 p-4 rounded-full mb-2 group-hover:scale-110 transition"><Icon path={Icons.Building} size={32}/></div><span className="font-bold text-gray-800 text-lg text-center">{dept.name}</span><span className="bg-gray-100 px-3 py-1 rounded-full text-xs font-bold text-gray-500">{data.assets.filter(a => a.location === dept.name).length} ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span></div>
                            ))}
                        </div>
                        {showDeptModal && (<div className="fixed inset-0 bg-black/40 z-[60] flex items-center justify-center p-4 backdrop-blur-sm fade-in"><div className="bg-white w-full max-w-sm rounded-3xl p-6 shadow-2xl relative animate-[scaleIn_0.2s_ease-out]"><button onClick={() => setShowDeptModal(false)} className="absolute top-4 right-4 bg-gray-100 p-2 rounded-full hover:bg-gray-200 transition"><Icon path={Icons.Close} size={20}/></button><h3 className="font-bold text-xl text-gray-800 mb-6">‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏´‡∏°‡πà</h3><div className="space-y-4"><div><label className="text-sm font-bold text-gray-500 mb-1.5 block">‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å</label><input className="input-box" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ù‡πà‡∏≤‡∏¢‡∏ú‡∏•‡∏¥‡∏ï" value={newDept.name} onChange={e => setNewDept({ ...newDept, name: e.target.value })} /></div><div><label className="text-sm font-bold text-gray-500 mb-1.5 block">‡∏£‡∏´‡∏±‡∏™‡∏¢‡πà‡∏≠ (3 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</label><input className="input-box uppercase font-mono" placeholder="‡πÄ‡∏ä‡πà‡∏ô PD" maxLength="3" value={newDept.code} onChange={e => setNewDept({ ...newDept, code: e.target.value.toUpperCase() })} /></div><button onClick={() => { if (newDept.name && newDept.code) postData({ action: 'save_dept', ...newDept }); else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); }} className="w-full bg-blue-600 text-white py-3.5 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition mt-2">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á</button></div></div></div>)}
                    </div>
                );
            };

            const AssetListView = () => {
                const [term, setTerm] = useState('');
                const filtered = data.assets.filter(a => a.location === selectedDept && (a.name.toLowerCase().includes(term.toLowerCase()) || a.id.toLowerCase().includes(term.toLowerCase())));
                return (
                    <div className="p-6 md:p-10 w-full max-w-7xl mx-auto h-full flex flex-col pb-24 md:pb-10 fade-in">
                        <div className="flex flex-col md:flex-row md:items-center gap-4 mb-8"><div className="flex items-center gap-4 flex-1"><button onClick={() => setView('departments')} className="p-2.5 bg-white rounded-xl border shadow-sm text-gray-600 hover:bg-gray-50 transition"><Icon path={Icons.ArrowLeft} size={20}/></button><h2 className="text-2xl font-bold truncate text-gray-800">{selectedDept}</h2></div><div className="relative w-full md:w-96"><div className="absolute left-4 top-3.5 text-gray-400"><Icon path={Icons.Search} size={18}/></div><input className="input-box pl-11 shadow-sm border-0" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏£‡∏´‡∏±‡∏™..." value={term} onChange={e => setTerm(e.target.value)}/></div><button onClick={() => setView('add_asset')} className="hidden md:flex bg-blue-600 text-white px-5 py-2.5 rounded-xl font-bold shadow-lg hover:bg-blue-700 transition items-center gap-2"><Icon path={Icons.Add} size={20}/> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button></div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 overflow-y-auto pb-10">
                            {filtered.map(item => (
                                <div key={item.id} onClick={() => { setSelectedAsset(item); setView('detail'); }} className="bg-white p-4 rounded-2xl border border-gray-100 shadow-sm flex flex-col gap-3 cursor-pointer card-hover h-full group"><div className="w-full h-40 bg-gray-50 rounded-xl overflow-hidden border border-gray-200 relative">{item.image ? <img src={item.image} className="w-full h-full object-cover group-hover:scale-105 transition duration-500" /> : <div className="flex items-center justify-center h-full text-gray-300"><Icon path={Icons.Image} size={40}/></div>}<div className={`absolute top-2 right-2 px-2 py-1 rounded-lg text-[10px] font-bold shadow-sm backdrop-blur-sm ${item.status === '‡∏õ‡∏Å‡∏ï‡∏¥' ? 'bg-white/90 text-green-600' : 'bg-orange-500 text-white'}`}>{item.status}</div></div><div><div className="font-bold text-gray-800 text-lg truncate">{item.name}</div><div className="text-xs text-gray-400 font-mono mb-2">{item.id}</div><div className="text-sm text-gray-500 bg-gray-50 px-2 py-1 rounded inline-block">{item.model || '-'}</div></div></div>
                            ))}
                        </div>
                    </div>
                );
            };

            const AddAssetView = () => {
                const [form, setForm] = useState({ id: '‡∏£‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥...', name: '', model: '', location: selectedDept || '', status: '‡∏õ‡∏Å‡∏ï‡∏¥', purchaseDate: new Date().toISOString().split('T')[0], image: '', receiptPdf: '' });
                const handleFile = async (e, k) => { if (e.target.files[0]) setForm({ ...form, [k]: await fileToBase64(e.target.files[0]) }) };
                useEffect(() => {
                    if (form.location) {
                        const deptObj = data.departments.find(d => d.name === form.location);
                        if (deptObj) {
                            const code = deptObj.code;
                            const year = new Date().getFullYear();
                            const prefix = `MTA-${code}-${year}-`;
                            const existingIds = data.assets.filter(a => a.id && a.id.startsWith(prefix)).map(a => parseInt(a.id.split('-').pop()));
                            const nextNum = existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1;
                            setForm(prev => ({ ...prev, id: `${prefix}${String(nextNum).padStart(4, '0')}` }));
                        }
                    }
                }, [form.location]);
                return (
                    <div className="p-6 md:p-10 w-full max-w-4xl mx-auto h-full flex flex-col pb-24 md:pb-10 fade-in overflow-y-auto">
                        <div className="flex items-center gap-4 mb-8"><button onClick={() => setView('departments')} className="p-3 bg-white rounded-xl border shadow-sm text-gray-600 hover:bg-gray-50"><Icon path={Icons.ArrowLeft} size={20}/></button><h2 className="text-2xl font-bold text-gray-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h2></div>
                        <div className="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-gray-100 flex flex-col md:flex-row gap-8"><div className="w-full md:w-1/3"><div className="aspect-square bg-gray-50 border-2 border-dashed border-gray-300 rounded-2xl flex flex-col items-center justify-center relative overflow-hidden hover:bg-gray-100 transition group cursor-pointer">{form.image ? <img src={form.image} className="w-full h-full object-cover" /> : <div className="text-gray-400 text-sm flex flex-col items-center font-bold gap-2"><Icon path={Icons.Image} size={48} className="text-gray-300 group-hover:text-blue-400 transition"/>‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</div>}<input type="file" accept="image/*" className="absolute inset-0 opacity-0 cursor-pointer" onChange={e => handleFile(e, 'image')} /></div></div><div className="flex-1 space-y-5"><div><label className="text-sm font-bold text-gray-600 mb-1.5 block">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label><input className="input-box" value={form.name} onChange={e => setForm({ ...form, name: e.target.value })} /></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label className="text-sm font-bold text-gray-600 mb-1.5 block">‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô (Auto)</label><input className="input-box bg-gray-100 text-gray-500 font-mono font-bold border-transparent" value={form.id} disabled /></div><div><label className="text-sm font-bold text-gray-600 mb-1.5 block">‡∏£‡∏∏‡πà‡∏ô / Model</label><input className="input-box" value={form.model} onChange={e => setForm({ ...form, model: e.target.value })} /></div></div><div className="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label className="text-sm font-bold text-gray-600 mb-1.5 block">‡πÅ‡∏ú‡∏ô‡∏Å</label><select className="input-box" value={form.location} onChange={e => setForm({ ...form, location: e.target.value })}><option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å --</option>{data.departments.map(d => <option key={d.name} value={d.name}>{d.name} ({d.code})</option>)}</select></div><div><label className="text-sm font-bold text-gray-600 mb-1.5 block">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label><select className="input-box" value={form.status} onChange={e => setForm({ ...form, status: e.target.value })}><option>‡∏õ‡∏Å‡∏ï‡∏¥</option><option>‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°</option><option>‡πÄ‡∏™‡∏µ‡∏¢</option></select></div></div><div><label className="text-sm font-bold text-gray-600 mb-1.5 block">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label><input type="date" className="input-box" value={form.purchaseDate} onChange={e => setForm({ ...form, purchaseDate: e.target.value })} /></div><div className="bg-orange-50 p-4 rounded-xl border border-orange-100 text-sm text-orange-800 flex items-center justify-between"><span className="font-bold flex items-center gap-2"><Icon path={Icons.File} size={18}/> ‡πÅ‡∏ô‡∏ö‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (PDF)</span><label className="bg-white border border-orange-200 text-orange-600 px-3 py-1.5 rounded-lg cursor-pointer hover:bg-orange-50 transition text-xs font-bold shadow-sm">{form.receiptPdf ? '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÑ‡∏ü‡∏•‡πå' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå'}<input type="file" accept="application/pdf" className="hidden" onChange={e => handleFile(e, 'receiptPdf')} /></label></div><button onClick={() => postData({ action: 'save_asset', ...form })} className="w-full bg-slate-900 hover:bg-black text-white py-4 rounded-xl font-bold shadow-lg shadow-gray-300 transition mt-4 text-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button></div></div>
                    </div>
                );
            };

            const DetailAssetView = () => {
                const item = selectedAsset;
                const [tab, setTab] = useState('history');
                const [log, setLog] = useState({ date: new Date().toISOString().split('T')[0], type: '‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°', description: '', labor: '', parts: [] });
                const [part, setPart] = useState({ name: '', price: '', image: '', pdf: '' });
                const [selLog, setSelLog] = useState(null);
                const [fileLoading, setFileLoading] = useState(false);

                const handlePartFile = async (e, k) => {
                    if (e.target.files[0]) {
                        setFileLoading(true);
                        try {
                            const base64 = await fileToBase64(e.target.files[0]);
                            if (base64) { setPart(prev => ({ ...prev, [k]: base64 })); alert("‡πÅ‡∏ô‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); }
                        } catch (err) { alert("Error reading file"); }
                        finally { setFileLoading(false); }
                    }
                };
                const addPart = () => { if (part.name) { setLog(prev => ({ ...prev, parts: [...prev.parts, part] })); setPart({ name: '', price: '', image: '', pdf: '' }); } else { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà"); } };
                
                const submitLog = () => {
                    const total = Number(log.labor) + log.parts.reduce((s, p) => s + Number(p.price), 0);
                    // *** FIX: Auto-add pending part if user forgot to click + ***
                    let finalParts = [...log.parts];
                    if (part.name) finalParts.push(part); 
                    const newLog = { id: Date.now(), date: log.date, type: log.type, description: log.description, laborCost: log.labor, totalCost: total + (part.name ? Number(part.price) : 0), parts: finalParts };
                    postData({ action: 'save_log', assetId: item.id, log: newLog });
                };

                return (
                    <div className="w-full h-full flex flex-col bg-gray-50 relative overflow-y-auto pb-24 md:pb-0 fade-in">
                        <div className="relative h-64 md:h-80 bg-slate-900 flex-shrink-0">{item.image ? <img src={item.image} className="w-full h-full object-cover opacity-70" /> : <div className="w-full h-full flex items-center justify-center text-white/20"><Icon path={Icons.Image} size={80}/></div>}<div className="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent to-transparent"></div><button onClick={() => setView('assets')} className="absolute top-4 left-4 bg-white/20 p-2.5 rounded-full backdrop-blur-md text-white hover:bg-white/30 transition"><Icon path={Icons.ArrowLeft} size={24}/></button><div className="absolute bottom-0 w-full p-6 md:p-10 text-white max-w-7xl mx-auto"><h1 className="text-3xl md:text-5xl font-bold mb-2">{item.name}</h1><div className="flex flex-wrap gap-3 items-center opacity-90 font-mono text-sm md:text-base"><span className="bg-white/20 px-2 py-1 rounded border border-white/10">{item.id}</span><span>{item.model}</span><span>‚Ä¢ {item.location}</span><span className={`px-2 py-1 rounded font-bold text-black ${item.status === '‡∏õ‡∏Å‡∏ï‡∏¥' ? 'bg-green-400' : 'bg-orange-400'}`}>{item.status}</span></div></div></div>
                        <div className="flex-1 max-w-7xl mx-auto w-full p-4 md:p-8 -mt-8 relative z-10"><div className="flex flex-col lg:flex-row gap-6"><div className="w-full lg:w-1/3 space-y-4"><div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100"><h3 className="font-bold text-gray-800 mb-4 text-lg border-b pb-3">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</h3><div className="space-y-4 text-sm text-gray-600"><div className="flex justify-between"><span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</span><span className="font-bold text-gray-900">{item.purchaseDate}</span></div><div className="flex justify-between"><span>‡∏£‡∏∏‡πà‡∏ô</span><span className="font-bold text-gray-900">{item.model || '-'}</span></div>{item.receiptPdf && <a href={item.receiptPdf} target="_blank" className="flex items-center justify-center gap-2 w-full py-3 mt-2 bg-orange-50 text-orange-700 rounded-xl font-bold hover:bg-orange-100 transition"><Icon path={Icons.File} size={18}/> ‡∏î‡∏π‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</a>}</div><button onClick={() => { if (confirm('‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏ñ‡∏≤‡∏ß‡∏£?')) postData({ action: 'delete_asset', id: item.id }); }} className="w-full mt-6 text-red-500 text-sm font-bold hover:bg-red-50 py-3 rounded-xl transition flex justify-center gap-2"><Icon path={Icons.Trash} size={18}/> ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button></div></div><div className="w-full lg:w-2/3"><div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden min-h-[500px]"><div className="flex border-b border-gray-100"><button onClick={() => setTab('history')} className={`flex-1 py-4 text-sm font-bold border-b-2 transition ${tab === 'history' ? 'border-blue-600 text-blue-600 bg-blue-50/50' : 'border-transparent text-gray-400 hover:text-gray-600'}`}>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏° ({item.history?.length || 0})</button><button onClick={() => setTab('newlog')} className={`flex-1 py-4 text-sm font-bold border-b-2 transition ${tab === 'newlog' ? 'border-blue-600 text-blue-600 bg-blue-50/50' : 'border-transparent text-gray-400 hover:text-gray-600'}`}>+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡πà‡∏≠‡∏°‡πÉ‡∏´‡∏°‡πà</button></div><div className="p-6">{tab === 'newlog' && (<div className="animate-[fadeIn_0.3s_ease-out]"><div className="grid grid-cols-2 gap-4 mb-4"><div><label className="text-xs font-bold text-gray-500 mb-1.5 block">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" className="input-box" value={log.date} onChange={e => setLog({ ...log, date: e.target.value })} /></div><div><label className="text-xs font-bold text-gray-500 mb-1.5 block">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select className="input-box" value={log.type} onChange={e => setLog({ ...log, type: e.target.value })}><option>‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</option><option>‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</option></select></div></div><div className="mb-6"><label className="text-xs font-bold text-gray-500 mb-1.5 block">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><textarea className="input-box" rows="3" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏≠‡∏≤‡∏Å‡∏≤‡∏£..." onChange={e => setLog({ ...log, description: e.target.value })}></textarea></div><div className="bg-gray-50 p-5 rounded-2xl border border-gray-200 mb-6 relative"><p className="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</p><div className="flex flex-wrap gap-2 mb-3 items-center"><input className="input-box p-2 text-sm flex-1 min-w-[120px]" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà" value={part.name} onChange={e => setPart({ ...part, name: e.target.value })} /><input className="input-box p-2 text-sm w-24" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" value={part.price} onChange={e => setPart({ ...part, price: e.target.value })} /><label className={`border p-2 rounded-lg cursor-pointer transition ${part.image ? 'bg-green-100 text-green-700 border-green-300' : 'bg-white hover:bg-gray-100'}`} title="‡πÅ‡∏ô‡∏ö‡∏£‡∏π‡∏õ"><Icon path={Icons.Image} size={18}/><input type="file" className="hidden" accept="image/*" onChange={e => handlePartFile(e, 'image')} /></label><label className={`border p-2 rounded-lg cursor-pointer transition ${part.pdf ? 'bg-green-100 text-green-700 border-green-300' : 'bg-white hover:bg-gray-100'}`} title="‡πÅ‡∏ô‡∏ö PDF"><Icon path={Icons.File} size={18}/><input type="file" className="hidden" accept="application/pdf" onChange={e => handlePartFile(e, 'pdf')} /></label><button onClick={addPart} className="bg-slate-800 text-white w-9 h-9 rounded-lg hover:bg-black flex items-center justify-center transition"><Icon path={Icons.Plus} size={18}/></button></div>{fileLoading && <div className="text-xs text-blue-500 animate-pulse mb-2 font-bold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå...</div>}<div className="space-y-2">{log.parts.map((p, i) => (<div key={i} className="text-xs flex justify-between p-3 bg-white rounded-xl border font-medium shadow-sm items-center"><div className="flex items-center gap-2"><span className="font-bold text-gray-700">{p.name}</span>{p.image && <Icon path={Icons.Image} size={12} className="text-blue-500"/>}{p.pdf && <Icon path={Icons.File} size={12} className="text-orange-500"/>}</div><span>‡∏ø{Number(p.price).toLocaleString()}</span></div>))}</div></div><div className="mb-6"><label className="text-xs font-bold text-gray-500 mb-1.5 block">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ä‡πà‡∏≤‡∏á (‡∏ö‡∏≤‡∏ó)</label><input type="number" className="input-box" placeholder="0.00" onChange={e => setLog({ ...log, labor: e.target.value })} /></div><button onClick={submitLog} disabled={fileLoading} className={`w-full text-white py-3.5 rounded-xl font-bold shadow-lg transition ${fileLoading ? 'bg-gray-400 cursor-not-allowed' : 'bg-blue-600 hover:bg-blue-700'}`}>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button></div>)}
                                            {tab === 'history' && (<div className="space-y-4 animate-[fadeIn_0.3s_ease-out]">{item.history && item.history.map((h, i) => (<div key={i} onClick={() => setSelLog(h)} className="bg-white border border-gray-100 rounded-2xl p-5 cursor-pointer hover:border-blue-400 hover:shadow-md transition group"><div className="flex justify-between items-start mb-2"><div><div className="text-xs font-bold text-gray-400 flex items-center gap-2 mb-1">{h.date} <span className="px-2 py-0.5 bg-gray-100 rounded text-gray-600">{h.type}</span></div><div className="font-bold text-gray-800 text-lg">{h.description}</div></div><div className="text-right"><div className="font-bold text-blue-600 text-lg">‡∏ø{Number(h.totalCost).toLocaleString()}</div></div></div>{h.parts?.length > 0 && <div className="text-xs text-gray-500 mt-2 bg-gray-50 p-2 rounded-lg inline-block border border-gray-100">‡πÉ‡∏ä‡πâ‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà {h.parts.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>}</div>))}{(!item.history || item.history.length === 0) && <div className="text-center text-gray-400 py-12 flex flex-col items-center"><Icon path={Icons.Folder} size={48} className="mb-2 opacity-30"/><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</p></div>}</div>)}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {selLog && (<div className="fixed inset-0 bg-black/50 z-[60] flex items-center justify-center p-4 backdrop-blur-sm fade-in"><div className="bg-white w-full max-w-lg rounded-3xl p-6 shadow-2xl relative max-h-[90vh] overflow-y-auto"><button onClick={() => setSelLog(null)} className="absolute top-4 right-4 bg-gray-100 p-2 rounded-full hover:bg-gray-200 transition"><Icon path={Icons.Close} size={20}/></button><div className="mb-6 border-b pb-4"><div className="text-gray-500 text-sm font-medium">{selLog.date}</div><h3 className="font-bold text-2xl text-gray-900 mt-1">{selLog.type}</h3></div><div className="space-y-6"><div><span className="text-xs font-bold text-gray-400 uppercase tracking-wider block mb-2">‡∏≠‡∏≤‡∏Å‡∏≤‡∏£ / ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span><div className="bg-gray-50 p-4 rounded-xl text-gray-700 border border-gray-100 font-medium">{selLog.description}</div></div><div><span className="text-xs font-bold text-gray-400 uppercase tracking-wider block mb-2">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</span><div className="border border-gray-200 rounded-xl overflow-hidden bg-gray-50">{selLog.parts?.map((p, i) => (<div key={i} className="flex flex-col p-4 border-b last:border-0 border-gray-200 bg-white"><div className="flex justify-between items-center mb-2"><span className="font-bold text-gray-800">{p.name}</span><span className="font-mono text-gray-600 font-bold">‡∏ø{Number(p.price).toLocaleString()}</span></div><div className="flex gap-2">{p.image && <a href={p.image} target="_blank" className="text-xs bg-blue-50 text-blue-600 px-3 py-1.5 rounded-lg hover:bg-blue-100 transition flex items-center gap-1 font-bold"><Icon path={Icons.Image} size={14}/> ‡∏î‡∏π‡∏£‡∏π‡∏õ</a>}{p.pdf && <a href={p.pdf} target="_blank" className="text-xs bg-orange-50 text-orange-600 px-3 py-1.5 rounded-lg hover:bg-orange-100 transition flex items-center gap-1 font-bold"><Icon path={Icons.File} size={14}/> ‡πÄ‡∏õ‡∏¥‡∏î PDF</a>}</div></div>))}{(!selLog.parts || selLog.parts.length === 0) && <div className="p-6 text-center text-gray-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</div>}</div></div><div className="flex justify-between items-center pt-4 border-t border-gray-100"><div className="text-sm text-gray-500 font-medium">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏ä‡πà‡∏≤‡∏á ‡∏ø{Number(selLog.laborCost).toLocaleString()}</div><div className="text-xl font-bold text-slate-900">‡∏£‡∏ß‡∏° ‡∏ø{Number(selLog.totalCost).toLocaleString()}</div></div><button onClick={() => { if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ô‡∏µ‡πâ?')) { postData({ action: 'delete_log', assetId: item.id, logId: selLog.id }); setSelLog(null); } }} className="w-full py-3 bg-red-50 text-red-500 font-bold rounded-xl hover:bg-red-100 transition text-sm">‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ</button></div></div></div>)}
                    </div>
                );
            };

            return (
                <div className="flex h-screen w-full bg-slate-50 overflow-hidden text-gray-800">
                    {(loading || submitting) && <LoadingOverlay text={submitting ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...'}/>}
                    <Sidebar /><main className="flex-1 h-full relative overflow-hidden flex flex-col bg-[#f8fafc]">{view === 'dashboard' && <DashboardView />}{view === 'departments' && <DepartmentView />}{view === 'assets' && <AssetListView />}{view === 'add_asset' && <AddAssetView />}{view === 'detail' && <DetailAssetView />}</main><MobileNav />
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
