<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Tracker System (Corrected Image View)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Camera, Plus, Save, Wrench, Clock, FileText, ChevronLeft, Search, Trash2, MapPin, Tag, ShoppingBag, DollarSign, X, LayoutDashboard, List, BarChart3, AlertTriangle, TrendingUp, Calendar, Folder, Image as ImageIcon, Building2, PlusCircle, Package, File as FileIcon, UploadCloud, Loader2, Settings, Lock, Check, RefreshCw, DownloadCloud } from 'lucide-react';

        // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô (‡πÉ‡∏™‡πà URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÉ‡∏´‡πâ‡πÅ‡∏•‡πâ‡∏ß) ---
        const DEFAULT_CONFIG = {
            scriptUrl: 'https://script.google.com/macros/s/AKfycbxrg3L1Kvzbjh5U0WlFve8ExsGYcC8YTte2qB8Rs5Ckkza4aDjQ4QRFpCtz599s1NdE/exec',
            adminPassword: '888'
        };

        // --- Helpers ---
        const fileToBase64 = (file) => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        const generateCode = () => `EQ-${new Date().getFullYear()}-${Math.floor(Math.random() * 10000).toString().padStart(4, '0')}`;

        const calculateAge = (dateString) => {
            if (!dateString) return '-';
            const start = new Date(dateString);
            const end = new Date();
            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            if (months < 0) { years--; months += 12; }
            if (years < 0) return "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            return years > 0 ? `${years} ‡∏õ‡∏µ ${months > 0 ? months + ' ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô' : ''}` : (months > 0 ? `${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô` : '‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠');
        };

        // --- Main App ---
        function App() {
            const [view, setView] = useState('dashboard');
            
            // ‡πÇ‡∏´‡∏•‡∏î Config ‡∏à‡∏≤‡∏Å LocalStorage ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ DEFAULT_CONFIG
            const [config, setConfig] = useState(() => {
                const saved = localStorage.getItem('assetTrackerConfig');
                // ‡∏ñ‡πâ‡∏≤‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ ‡∏´‡∏£‡∏∑‡∏≠ URL ‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö Default (‡∏Å‡∏£‡∏ì‡∏µ‡∏≠‡∏¢‡∏≤‡∏Å Reset) 
                // ‡πÅ‡∏ï‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏î‡∏ß‡∏Å ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÉ‡∏ä‡πâ saved ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ä‡πâ Default
                return saved ? JSON.parse(saved) : DEFAULT_CONFIG;
            });
            
            const [items, setItems] = useState([]); 
            const [departmentList, setDepartmentList] = useState([]);
            const [selectedItem, setSelectedItem] = useState(null);
            const [selectedDepartment, setSelectedDepartment] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            
            const [isLoading, setIsLoading] = useState(false);
            const [isSyncing, setIsSyncing] = useState(false);
            const [showAdminModal, setShowAdminModal] = useState(false);
            const [adminInputPassword, setAdminInputPassword] = useState('');
            const [tempConfig, setTempConfig] = useState(config);

            // Auto Load on Start
            useEffect(() => {
                if (config.scriptUrl) fetchFromGoogle();
            }, []);

            // --- Google API ---
            const fetchFromGoogle = async () => {
                if (!config.scriptUrl) return;
                setIsLoading(true);
                try {
                    const response = await fetch(config.scriptUrl);
                    const data = await response.json();
                    
                    if (Array.isArray(data)) {
                        setItems(data);
                        const depts = [...new Set(data.map(i => i.location).filter(Boolean))];
                        setDepartmentList(depts);
                    } else if (data.error) {
                        alert("Error: " + data.error);
                    }
                } catch (error) {
                    console.error("Fetch Error:", error);
                } finally {
                    setIsLoading(false);
                }
            };

            const syncToGoogle = async (itemData) => {
                if (!config.scriptUrl) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ URL");
                setIsSyncing(true);
                try {
                    await fetch(config.scriptUrl, {
                        method: 'POST',
                        mode: 'no-cors', 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(itemData)
                    });
                    
                    setTimeout(() => {
                        fetchFromGoogle(); // Refresh Data
                        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
                    }, 3000); // ‡∏£‡∏≠ 3 ‡∏ß‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ GAS ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à
                } catch (error) {
                    alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + error.message);
                } finally {
                    setIsSyncing(false);
                }
            };

            // --- Handlers ---
            const handleAddItem = (newItem) => {
                setItems(prev => [newItem, ...prev]);
                if (newItem.location && !departmentList.includes(newItem.location)) {
                    setDepartmentList(prev => [...prev, newItem.location]);
                }
                syncToGoogle(newItem);
                setSelectedDepartment(newItem.location);
                setView('departmentItems');
            };

            const handleUpdateItem = (updatedItem) => {
                setItems(prev => prev.map(item => item.id === updatedItem.id ? updatedItem : item));
                setSelectedItem(updatedItem);
                syncToGoogle(updatedItem);
            };

            const deleteItem = (id) => {
                if(confirm('‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏à‡∏∞‡πÅ‡∏Ñ‡πà "‡∏ã‡πà‡∏≠‡∏ô" ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡πÉ‡∏ô Google Sheet\n\n‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏ô?')) {
                    setItems(prev => prev.filter(i => i.id !== id));
                    setView('departmentItems');
                }
            };

            // --- Components ---
            const LoadingOverlay = () => (
                <div className="fixed inset-0 bg-white/80 z-50 flex flex-col items-center justify-center backdrop-blur-sm">
                    <Loader2 className="animate-spin text-blue-600 mb-2" size={48} />
                    <p className="text-slate-600 font-medium">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            );

            const DashboardView = () => {
                const totalAssets = items.length;
                const totalRepairs = items.reduce((sum, item) => sum + (item.history?.filter(h => h.type === 'repair').length || 0), 0);
                return (
                    <div className="space-y-6 fade-in pb-10">
                        <div className="bg-blue-600 text-white p-6 rounded-2xl shadow-lg flex justify-between items-center">
                             <div>
                                <h2 className="text-2xl font-bold mb-1">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
                                <p className="text-blue-100 text-sm">Asset Cloud Sync</p>
                             </div>
                             <div className="bg-white/20 p-3 rounded-lg"><DownloadCloud size={32}/></div>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                <div className="text-sm text-slate-500 mb-1">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                                <div className="text-4xl font-bold text-slate-800">{totalAssets}</div>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                                <div className="text-sm text-slate-500 mb-1">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á</div>
                                <div className="text-4xl font-bold text-orange-600">{totalRepairs}</div>
                            </div>
                        </div>
                    </div>
                );
            };

            const DepartmentListView = () => {
                const counts = items.reduce((acc, i) => { acc[i.location] = (acc[i.location] || 0) + 1; return acc; }, {});
                return (
                    <div className="fade-in pb-10">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-xl font-bold text-slate-800">‡πÅ‡∏ú‡∏ô‡∏Å ({departmentList.length})</h2>
                            <div className="flex gap-2">
                                <button onClick={() => { const n = prompt("‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏´‡∏°‡πà:"); if(n) setDepartmentList([...departmentList, n]); }} className="bg-white border px-3 py-2 rounded-lg text-sm flex items-center gap-1 shadow-sm"><PlusCircle size={16}/> ‡πÅ‡∏ú‡∏ô‡∏Å</button>
                                <button onClick={() => setView('add')} className="bg-blue-600 text-white px-3 py-2 rounded-lg text-sm flex items-center gap-1 shadow-md"><Plus size={16}/> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            {departmentList.map(dept => (
                                <div key={dept} onClick={() => { setSelectedDepartment(dept); setView('departmentItems'); }} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 hover:border-blue-400 cursor-pointer flex justify-between items-center transition">
                                    <div className="flex items-center gap-3"><div className="bg-blue-50 text-blue-600 p-2 rounded-lg"><Building2 size={20}/></div><span className="font-medium">{dept}</span></div>
                                    <span className="text-xs bg-slate-100 px-3 py-1 rounded-full text-slate-600 font-bold">{counts[dept] || 0}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const DepartmentItemsView = () => {
                const filtered = items.filter(i => i.location === selectedDepartment && (i.name.toLowerCase().includes(searchTerm.toLowerCase()) || i.id.toLowerCase().includes(searchTerm.toLowerCase())));
                return (
                    <div className="fade-in pb-10">
                        <div className="flex items-center gap-2 mb-4">
                            <button onClick={() => setView('departments')} className="p-2 hover:bg-slate-100 rounded-full"><ChevronLeft/></button>
                            <h2 className="text-xl font-bold truncate">{selectedDepartment}</h2>
                        </div>
                        <div className="relative mb-4">
                            <input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." className="w-full pl-10 pr-4 py-3 bg-white border border-slate-200 rounded-xl shadow-sm outline-none focus:ring-2 focus:ring-blue-500" onChange={e => setSearchTerm(e.target.value)} />
                            <Search className="absolute left-3 top-3.5 text-slate-400" size={18}/>
                        </div>
                        <div className="space-y-3">
                            {filtered.map(item => (
                                <div key={item.id} onClick={() => { setSelectedItem(item); setView('detail'); }} className="bg-white p-3 rounded-xl shadow-sm border border-slate-100 flex gap-3 cursor-pointer hover:shadow-md transition">
                                    <div className="w-20 h-20 bg-slate-100 rounded-lg flex-shrink-0 overflow-hidden border border-slate-100">
                                        {item.image ? <img src={item.image} className="w-full h-full object-cover"/> : <div className="w-full h-full flex items-center justify-center text-slate-300"><ImageIcon/></div>}
                                    </div>
                                    <div className="flex-1 min-w-0 flex flex-col justify-center">
                                        <div className="flex justify-between items-start mb-1">
                                            <h3 className="font-bold text-slate-800 truncate pr-2">{item.name}</h3>
                                            <span className={`text-[10px] px-2 py-0.5 rounded-full flex-shrink-0 ${item.status==='active'?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}`}>{item.status==='active'?'‡∏õ‡∏Å‡∏ï‡∏¥':'‡∏ã‡πà‡∏≠‡∏°'}</span>
                                        </div>
                                        <div className="text-xs text-slate-500 font-mono mb-1">{item.id}</div>
                                        <div className="flex items-center gap-3 text-xs text-slate-400">
                                            <span className="flex items-center gap-1"><Clock size={12}/> {calculateAge(item.purchaseDate)}</span>
                                            {item.receiptPdf && <span className="flex items-center gap-1 text-orange-500"><FileIcon size={12}/> PDF</span>}
                                        </div>
                                    </div>
                                </div>
                            ))}
                            {filtered.length === 0 && <div className="text-center py-10 text-slate-400">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div>}
                        </div>
                    </div>
                );
            };

            const AddView = () => {
                const [form, setForm] = useState({ id: generateCode(), name: '', location: selectedDepartment || '', purchaseDate: new Date().toISOString().split('T')[0], status: 'active', history: [] });
                const handleFile = async (e, k) => { if(e.target.files[0]) setForm({...form, [k]: await fileToBase64(e.target.files[0])}) };
                return (
                    <div className="fade-in max-w-lg mx-auto pb-10">
                        <button onClick={() => setView('departments')} className="mb-4 flex items-center gap-1 text-slate-500"><ChevronLeft size={20}/> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100">
                            <h2 className="text-xl font-bold mb-6 flex items-center gap-2"><Plus className="text-blue-600"/> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h2>
                            <form onSubmit={e => { e.preventDefault(); handleAddItem(form); }} className="space-y-4">
                                <div className="w-full h-40 bg-slate-50 border-2 border-dashed border-slate-300 rounded-xl flex items-center justify-center relative overflow-hidden group">
                                    {form.image ? <img src={form.image} className="w-full h-full object-cover"/> : <div className="text-center text-slate-400"><Camera className="mx-auto mb-2" size={32}/><span className="text-sm">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ</span></div>}
                                    <input type="file" onChange={e => handleFile(e, 'image')} className="absolute inset-0 opacity-0 cursor-pointer" accept="image/*"/>
                                </div>
                                <input className="w-full p-2 border rounded-lg" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå" required onChange={e => setForm({...form, name: e.target.value})}/>
                                <input className="w-full p-2 border rounded-lg" placeholder="‡∏£‡∏∏‡πà‡∏ô / Model" onChange={e => setForm({...form, model: e.target.value})}/>
                                <div className="grid grid-cols-2 gap-4">
                                    <input type="date" className="w-full p-2 border rounded-lg" value={form.purchaseDate} onChange={e => setForm({...form, purchaseDate: e.target.value})}/>
                                    <input className="w-full p-2 border rounded-lg" list="depts" value={form.location} placeholder="‡πÅ‡∏ú‡∏ô‡∏Å" onChange={e => setForm({...form, location: e.target.value})}/>
                                    <datalist id="depts">{departmentList.map(d=><option key={d} value={d}/>)}</datalist>
                                </div>
                                <div className="bg-orange-50 p-4 rounded-xl border border-orange-100">
                                    <label className="flex items-center gap-2 text-orange-800 font-bold text-sm mb-2"><FileIcon size={16}/> ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (PDF)</label>
                                    <input type="file" accept="application/pdf" onChange={e => handleFile(e, 'receiptPdf')} className="block w-full text-sm text-slate-500 file:text-orange-700"/>
                                </div>
                                <button type="submit" disabled={isSyncing} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold shadow-lg hover:bg-blue-700 disabled:bg-slate-300 mt-4">
                                    {isSyncing ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...' : '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}
                                </button>
                            </form>
                        </div>
                    </div>
                );
            };

            const DetailView = () => {
                const item = selectedItem;
                const [tab, setTab] = useState('info');
                const [log, setLog] = useState({ id: Date.now(), date: new Date().toISOString().split('T')[0], type: 'repair', description: '', laborCost: 0, parts: [] });
                const [part, setPart] = useState({ name: '', price: 0, image: null, receiptPdf: null });
                const handlePartFile = async (e, k) => { if(e.target.files[0]) setPart({...part, [k]: await fileToBase64(e.target.files[0])}) };

                const saveLog = () => {
                    const newEntry = { ...log, id: Date.now(), totalCost: Number(log.laborCost) + log.parts.reduce((s,p)=>s+Number(p.price),0) };
                    const updatedHistory = [newEntry, ...(item.history || [])];
                    handleUpdateItem({ ...item, history: updatedHistory });
                    setTab('info');
                    setLog({ id: Date.now(), date: new Date().toISOString().split('T')[0], type: 'repair', description: '', laborCost: 0, parts: [] });
                };

                return (
                    <div className="fade-in max-w-2xl mx-auto pb-10">
                        <button onClick={() => setView('departmentItems')} className="mb-4 flex items-center gap-1 text-slate-500"><ChevronLeft size={20}/> ‡∏Å‡∏•‡∏±‡∏ö</button>
                        <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden mb-4">
                            <div className="h-64 bg-slate-200 relative">
                                {item.image ? <img src={item.image} className="w-full h-full object-cover"/> : <div className="flex items-center justify-center h-full text-slate-300"><ImageIcon size={64}/></div>}
                                <div className="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/70 to-transparent p-6 pt-20">
                                    <h1 className="text-2xl font-bold text-white">{item.name}</h1>
                                    <p className="text-white/80 text-sm font-mono">{item.id}</p>
                                </div>
                            </div>
                            <div className="flex border-b">
                                <button onClick={() => setTab('info')} className={`flex-1 py-4 text-sm font-medium border-b-2 transition ${tab==='info'?'text-blue-600 border-blue-600 bg-blue-50/50':'text-slate-500 border-transparent'}`}>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</button>
                                <button onClick={() => setTab('history')} className={`flex-1 py-4 text-sm font-medium border-b-2 transition ${tab==='history'?'text-blue-600 border-blue-600 bg-blue-50/50':'text-slate-500 border-transparent'}`}>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ã‡πà‡∏≠‡∏° ({item.history?.length || 0})</button>
                            </div>
                            <div className="p-6">
                                {tab === 'info' && (
                                    <div className="space-y-6">
                                        <div className="grid grid-cols-2 gap-6">
                                            <div><div className="text-xs text-slate-500 uppercase mb-1">‡∏£‡∏∏‡πà‡∏ô</div><div className="font-medium">{item.model || '-'}</div></div>
                                            <div><div className="text-xs text-slate-500 uppercase mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</div><div className="font-medium">{item.purchaseDate}</div></div>
                                            <div><div className="text-xs text-slate-500 uppercase mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div><div className={`inline-block px-2 py-1 rounded text-xs font-bold ${item.status==='active'?'bg-green-100 text-green-700':'bg-red-100 text-red-700'}`}>{item.status==='active'?'‡∏õ‡∏Å‡∏ï‡∏¥':'‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'}</div></div>
                                            <div><div className="text-xs text-slate-500 uppercase mb-1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</div><div className="font-medium">{item.location}</div></div>
                                        </div>
                                        {item.receiptPdf ? <a href={item.receiptPdf} target="_blank" className="flex items-center justify-center gap-2 bg-orange-50 text-orange-700 p-4 rounded-xl border border-orange-100 hover:bg-orange-100"><FileIcon size={20}/> ‡∏î‡∏π‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à (PDF)</a> : <div className="text-center p-4 bg-slate-50 rounded-xl text-slate-400 text-sm">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</div>}
                                        <div className="pt-6 border-t border-slate-100">
                                            <button onClick={() => deleteItem(item.id)} className="w-full flex items-center justify-center gap-2 border border-red-200 text-red-500 py-3 rounded-xl text-sm hover:bg-red-50"><Trash2 size={16}/> ‡∏ã‡πà‡∏≠‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                                        </div>
                                    </div>
                                )}
                                {tab === 'history' && (
                                    <div>
                                        <div className="bg-slate-50 p-4 rounded-xl border border-slate-200 mb-6">
                                            <h3 className="font-bold text-sm mb-4 text-slate-800 flex items-center gap-2"><Wrench size={16}/> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</h3>
                                            <div className="space-y-3">
                                                <div className="grid grid-cols-3 gap-2">
                                                    <div className="col-span-1"><input type="date" className="w-full border p-2 rounded-lg text-sm" value={log.date} onChange={e=>setLog({...log, date:e.target.value})}/></div>
                                                    <div className="col-span-2"><select className="w-full border p-2 rounded-lg text-sm" onChange={e=>setLog({...log, type:e.target.value})}><option value="repair">‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°</option><option value="maintenance">‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</option></select></div>
                                                </div>
                                                <textarea className="w-full border p-2 rounded-lg text-sm" rows="2" placeholder="‡∏≠‡∏≤‡∏Å‡∏≤‡∏£/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." onChange={e=>setLog({...log, description:e.target.value})}></textarea>
                                                <div className="bg-white p-3 rounded-lg border border-slate-200">
                                                    <div className="text-xs font-bold text-slate-700 mb-2">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</div>
                                                    <div className="flex gap-2 mb-2">
                                                        <input className="border p-2 rounded-lg text-sm flex-1" placeholder="‡∏ä‡∏∑‡πà‡∏≠" value={part.name} onChange={e=>setPart({...part, name:e.target.value})}/>
                                                        <input className="border p-2 rounded-lg text-sm w-24" type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" value={part.price} onChange={e=>setPart({...part, price:e.target.value})}/>
                                                    </div>
                                                    <div className="flex gap-2 mb-2">
                                                        <label className="flex-1 bg-slate-100 text-xs py-2 rounded-lg text-center cursor-pointer">{part.image?'‚úì ‡∏£‡∏π‡∏õ':'‡∏£‡∏π‡∏õ'} <input type="file" className="hidden" accept="image/*" onChange={e=>handlePartFile(e,'image')}/></label>
                                                        <label className="flex-1 bg-orange-50 text-xs py-2 rounded-lg text-center cursor-pointer">{part.receiptPdf?'‚úì PDF':'PDF'} <input type="file" className="hidden" accept="application/pdf" onChange={e=>handlePartFile(e,'receiptPdf')}/></label>
                                                        <button onClick={()=>{ if(part.name) { setLog({...log, parts:[...log.parts, part]}); setPart({name:'', price:0, image:null, receiptPdf:null}); }}} className="bg-blue-600 text-white px-4 rounded-lg">+</button>
                                                    </div>
                                                    {log.parts.map((p,i)=><div key={i} className="text-xs flex justify-between p-1 bg-slate-50 border mb-1 rounded">{p.name} <span>‡∏ø{p.price}</span></div>)}
                                                </div>
                                                <input type="number" className="w-full border p-2 rounded-lg text-sm" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á" onChange={e=>setLog({...log, laborCost:e.target.value})}/>
                                                <button onClick={saveLog} disabled={isSyncing} className="w-full bg-slate-800 text-white py-3 rounded-xl text-sm font-bold shadow hover:bg-slate-900">{isSyncing?<Loader2 className="animate-spin mx-auto"/>:'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥'}</button>
                                            </div>
                                        </div>
                                        <div className="space-y-4">
                                            {item.history && item.history.map((h, i) => (
                                                <div key={i} className="flex gap-4 relative">
                                                    <div className="flex flex-col items-center"><div className="w-3 h-3 rounded-full bg-blue-500 mt-1.5 ring-4 ring-blue-50"></div><div className="w-0.5 bg-slate-200 flex-1 my-1"></div></div>
                                                    <div className="flex-1 pb-6 border-b border-slate-50 last:border-0">
                                                        <div className="flex justify-between items-start"><span className="font-bold text-slate-800 text-sm">{h.description}</span><span className="font-bold text-blue-600 text-sm">‡∏ø{Number(h.totalCost).toLocaleString()}</span></div>
                                                        <div className="text-xs text-slate-400 mt-1">{h.date} ‚Ä¢ {h.type}</div>
                                                        {h.parts && h.parts.length > 0 && <div className="mt-2 bg-slate-50 p-3 rounded-lg text-xs space-y-1">{h.parts.map((p, idx)=><div key={idx} className="flex justify-between"><span>{p.receiptPdf && 'üìÑ '} {p.name}</span><span>‡∏ø{p.price}</span></div>)}</div>}
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            };

            const AdminModal = () => (
                showAdminModal ? (
                <div className="fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white p-6 rounded-2xl w-full max-w-sm shadow-2xl">
                        <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-lg flex items-center gap-2"><Settings className="text-slate-700"/> ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3><button onClick={()=>setShowAdminModal(false)}><X/></button></div>
                        {showAdminModal === 'login' ? (
                            <form onSubmit={e => { e.preventDefault(); if(adminInputPassword===config.adminPassword) setShowAdminModal('settings'); else alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏¥‡∏î'); }}>
                                <input type="password" autoFocus className="w-full border p-3 rounded-xl mb-4" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (888)" onChange={e=>setAdminInputPassword(e.target.value)}/>
                                <button className="bg-slate-800 text-white w-full py-3 rounded-xl">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                            </form>
                        ) : (
                            <div>
                                <label className="text-xs font-bold text-slate-700 uppercase">Google Web App URL</label>
                                <input className="w-full border p-3 rounded-xl text-xs bg-slate-50 mb-4" value={tempConfig.scriptUrl} onChange={e=>setTempConfig({...tempConfig, scriptUrl:e.target.value})}/>
                                <label className="text-xs font-bold text-slate-700 uppercase">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™ Admin</label>
                                <input className="w-full border p-3 rounded-xl text-sm mb-6" value={tempConfig.adminPassword} onChange={e=>setTempConfig({...tempConfig, adminPassword:e.target.value})}/>
                                <button onClick={()=>{ setConfig(tempConfig); localStorage.setItem('assetTrackerConfig', JSON.stringify(tempConfig)); setShowAdminModal(false); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß'); fetchFromGoogle(); }} className="bg-green-600 text-white w-full py-3 rounded-xl font-bold">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                            </div>
                        )}
                    </div>
                </div>
                ) : null
            );

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900 pb-20">
                    {isLoading && <LoadingOverlay/>}
                    <header className="bg-white border-b sticky top-0 z-40 px-4 h-16 flex items-center justify-between shadow-sm">
                        <div className="font-bold flex items-center gap-2 text-lg text-slate-800"><div className="bg-blue-600 text-white p-1.5 rounded-lg"><FileText size={20}/></div> Asset Cloud</div>
                        <div className="flex gap-2">
                             <button onClick={fetchFromGoogle} className="p-2.5 text-slate-500 hover:bg-slate-100 rounded-full"><RefreshCw size={20}/></button>
                             <button onClick={() => setShowAdminModal('login')} className="p-2.5 text-slate-500 hover:bg-slate-100 rounded-full"><Settings size={20}/></button>
                        </div>
                    </header>
                    <main className="max-w-5xl mx-auto px-4 pt-6">
                        {view === 'dashboard' && <DashboardView />}
                        {view === 'departments' && <DepartmentListView />}
                        {view === 'departmentItems' && <DepartmentItemsView />}
                        {view === 'add' && <AddView />}
                        {view === 'detail' && <DetailView />}
                    </main>
                    <nav className="fixed bottom-0 left-0 w-full bg-white border-t h-16 flex justify-around items-center z-30 pb-safe">
                        <button onClick={() => setView('dashboard')} className={`flex flex-col items-center gap-1 text-[10px] ${view==='dashboard'?'text-blue-600':'text-slate-400'}`}><LayoutDashboard size={24}/> <span>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°</span></button>
                        <button onClick={() => setView('departments')} className={`flex flex-col items-center gap-1 text-[10px] ${['departments','departmentItems','add','detail'].includes(view)?'text-blue-600':'text-slate-400'}`}><List size={24}/> <span>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span></button>
                    </nav>
                    <AdminModal/>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
