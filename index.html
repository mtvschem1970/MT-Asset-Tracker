<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Tracker System (+PDF & Google Sync)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
        "imports": {
            "react": "https://esm.sh/react@18.2.0",
            "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
            "lucide-react": "https://esm.sh/lucide-react@0.263.1"
        }
    }
    </script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Camera, Plus, Save, Wrench, Clock, FileText, ChevronLeft, Search, Trash2, MapPin, Tag, ShoppingBag, DollarSign, X, LayoutDashboard, List, BarChart3, AlertTriangle, TrendingUp, Calendar, Folder, Image as ImageIcon, Building2, PlusCircle, Package, File as FileIcon, UploadCloud, Loader2 } from 'lucide-react';

        // --- CONFIGURATION ---
        // ‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ Deploy Google Apps Script ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxrg3L1Kvzbjh5U0WlFve8ExsGYcC8YTte2qB8Rs5Ckkza4aDjQ4QRFpCtz599s1NdE/exec'; 

        // --- Mock Data ---
        const initialData = [
            {
                id: 'EQ-2023-001',
                name: 'MacBook Pro 16"',
                model: 'M1 Pro',
                image: null,
                receiptPdf: null, // ‡πÄ‡∏û‡∏¥‡πà‡∏° field ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à
                purchaseDate: '2023-01-15',
                status: 'active',
                location: '‡πÅ‡∏ú‡∏ô‡∏Å IT',
                history: []
            }
        ];

        // --- Helper Functions ---
        const fileToBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        };

        const generateCode = () => {
            const year = new Date().getFullYear();
            const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
            return `EQ-${year}-${random}`;
        };

        const calculateAge = (dateString) => {
            if (!dateString) return '-';
            const start = new Date(dateString);
            const end = new Date();
            let years = end.getFullYear() - start.getFullYear();
            let months = end.getMonth() - start.getMonth();
            if (months < 0) { years--; months += 12; }
            if (years < 0) return "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô";
            let result = [];
            if (years > 0) result.push(`${years} ‡∏õ‡∏µ`);
            if (months > 0) result.push(`${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`);
            return result.length > 0 ? result.join(' ') : '‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠';
        };

        // --- Main Component ---
        function App() {
            const [view, setView] = useState('dashboard');
            const [selectedDepartment, setSelectedDepartment] = useState(null);
            
            // Data State
            const [items, setItems] = useState(initialData);
            const [departmentList, setDepartmentList] = useState([...new Set(initialData.map(i => i.location))]);
            const [selectedItem, setSelectedItem] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [isSyncing, setIsSyncing] = useState(false);

            // --- Google Sync Logic ---
            const syncToGoogle = async (itemData) => {
                if (GOOGLE_SCRIPT_URL === 'INSERT_YOUR_WEB_APP_URL_HERE') {
                    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà Web App URL ‡πÉ‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡πà‡∏ô‡∏ô‡∏µ‡πâ");
                    return;
                }

                setIsSyncing(true);
                try {
                    // ‡πÉ‡∏ä‡πâ mode: 'no-cors' ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS (‡πÅ‡∏ï‡πà‡∏à‡∏∞‡∏≠‡πà‡∏≤‡∏ô response ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)
                    // ‡∏´‡∏£‡∏∑‡∏≠‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô response ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ server GAS ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(itemData)
                    });
                    alert(`‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${itemData.name} ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google ‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏±‡∏á)`);
                } catch (error) {
                    console.error("Sync Error:", error);
                    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                } finally {
                    setIsSyncing(false);
                }
            };

            // CRUD Actions
            const handleAddItem = (newItem) => {
                setItems([newItem, ...items]);
                if (newItem.location && !departmentList.includes(newItem.location)) {
                    setDepartmentList([...departmentList, newItem.location]);
                }
                
                // Trigger Sync
                if(confirm("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ Google Drive/Sheet ‡πÄ‡∏•‡∏¢‡πÑ‡∏´‡∏°?")) {
                    syncToGoogle(newItem);
                }

                setSelectedDepartment(newItem.location);
                setView('departmentItems');
            };

            const handleUpdateItem = (updatedItem) => {
                const updatedList = items.map(item => item.id === updatedItem.id ? updatedItem : item);
                setItems(updatedList);
                setSelectedItem(updatedItem);
                
                // Trigger Sync Update (‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÑ‡∏õ)
                if(confirm("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏ó‡∏µ‡πà Google ‡∏î‡πâ‡∏ß‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                    syncToGoogle(updatedItem);
                }
            };

            const deleteItem = (id) => {
                if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Google Sheet ‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)')) {
                    const newItems = items.filter(i => i.id !== id);
                    setItems(newItems);
                    setView('departmentItems');
                    setSelectedItem(null);
                }
            };

            const handleAddDepartment = () => {
                const name = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏ú‡∏ô‡∏Å‡πÉ‡∏´‡∏°‡πà:");
                if (name && name.trim() !== "") {
                    if (!departmentList.includes(name.trim())) {
                        setDepartmentList([...departmentList, name.trim()]);
                    }
                }
            };

            const deleteDepartment = (deptName, e) => {
                e.stopPropagation();
                const hasItems = items.some(i => i.location === deptName);
                if (hasItems) return alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å "${deptName}" ‡πÑ‡∏î‡πâ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏≠‡∏¢‡∏π‡πà`);
                if (confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ú‡∏ô‡∏Å "${deptName}" ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) setDepartmentList(departmentList.filter(d => d !== deptName));
            };

            // --- Views ---
            const DashboardView = () => {
                // (‡∏Ñ‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏Å‡πà‡∏≤ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö‡∏Ç‡∏≠‡∏•‡∏∞‡πÑ‡∏ß‡πâ ‡πÅ‡∏ï‡πà‡πÉ‡∏™‡πà Logic ‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢)
                const totalAssets = items.length;
                const totalRepairs = items.reduce((sum, item) => sum + item.history.filter(h => h.type === 'repair').length, 0);
                return (
                    <div className="space-y-6 animate-fade-in pb-10">
                         <h2 className="text-2xl font-bold text-slate-800 mb-4">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö</h2>
                         <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4">
                                <div className="bg-blue-100 p-3 rounded-lg text-blue-600"><Tag size={24} /></div>
                                <div><div className="text-sm text-slate-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div><div className="text-2xl font-bold text-slate-800">{totalAssets}</div></div>
                            </div>
                            <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 flex items-center gap-4">
                                <div className="bg-orange-100 p-3 rounded-lg text-orange-600"><Wrench size={24} /></div>
                                <div><div className="text-sm text-slate-500">‡∏ã‡πà‡∏≠‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div><div className="text-2xl font-bold text-slate-800">{totalRepairs}</div></div>
                            </div>
                        </div>
                        <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 text-sm text-blue-800">
                            üí° ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏Å‡∏£‡∏î‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå PDF ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Sheets ‡πÅ‡∏•‡πâ‡∏ß
                        </div>
                    </div>
                );
            };

            const DepartmentListView = () => {
                 const departmentCounts = items.reduce((acc, item) => {
                    const loc = item.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    acc[loc] = (acc[loc] || 0) + 1;
                    return acc;
                }, {});
                return (
                    <div className="animate-fade-in pb-10">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold text-slate-800">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</h2>
                            <div className="flex gap-2">
                                <button onClick={handleAddDepartment} className="bg-white text-blue-600 border border-blue-200 px-4 py-2 rounded-lg flex items-center gap-2 shadow-sm hover:bg-blue-50 transition"><PlusCircle size={20} /> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ú‡∏ô‡∏Å</button>
                                <button onClick={() => setView('add')} className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 shadow-lg hover:bg-blue-700 transition"><Plus size={20} /> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                            </div>
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            {departmentList.map(dept => (
                                <div key={dept} onClick={() => { setSelectedDepartment(dept); setView('departmentItems'); }} className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 hover:shadow-md hover:border-blue-200 transition cursor-pointer flex flex-col items-center text-center gap-3 relative group">
                                    <div className="w-16 h-16 bg-blue-50 text-blue-600 rounded-full flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-colors"><Building2 size={32} /></div>
                                    <div><h3 className="font-bold text-lg text-slate-800">{dept}</h3><p className="text-sm text-slate-500">{departmentCounts[dept] || 0} ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</p></div>
                                    {(!departmentCounts[dept] || departmentCounts[dept] === 0) && (
                                        <button onClick={(e) => deleteDepartment(dept, e)} className="absolute top-2 right-2 text-slate-300 hover:text-red-500 p-2"><Trash2 size={16} /></button>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const DepartmentItemsView = () => {
                const filteredItems = items.filter(item => (item.location || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') === selectedDepartment && (item.name.toLowerCase().includes(searchTerm.toLowerCase()) || item.id.toLowerCase().includes(searchTerm.toLowerCase())));
                return (
                    <div className="animate-fade-in pb-10">
                        <div className="flex items-center gap-2 mb-4">
                            <button onClick={() => setView('departments')} className="p-2 hover:bg-slate-100 rounded-full text-slate-500"><ChevronLeft size={24} /></button>
                            <div><h2 className="text-2xl font-bold text-slate-800">{selectedDepartment}</h2></div>
                        </div>
                        <div className="relative mb-6"><input type="text" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." className="w-full pl-10 pr-4 py-2 border rounded-lg" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} /><Search className="absolute left-3 top-2.5 text-slate-400" size={18} /></div>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            {filteredItems.map(item => (
                                <div key={item.id} onClick={() => { setSelectedItem(item); setView('detail'); }} className="bg-white p-4 rounded-xl shadow-sm border border-slate-100 hover:shadow-md transition cursor-pointer flex gap-4">
                                    <div className="w-20 h-20 bg-slate-200 rounded-lg flex-shrink-0 flex items-center justify-center overflow-hidden">{item.image ? <img src={item.image} className="w-full h-full object-cover" /> : <Camera className="text-slate-400" />}</div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex justify-between items-start"><h3 className="font-semibold text-slate-800 truncate">{item.name}</h3><span className={`text-[10px] px-2 py-0.5 rounded-full ${item.status === 'active' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`}>{item.status === 'active' ? '‡∏õ‡∏Å‡∏ï‡∏¥' : '‡∏™‡πà‡∏á‡∏ã‡πà‡∏≠‡∏°'}</span></div>
                                        <p className="text-xs text-slate-500 mt-1 font-mono">{item.id}</p>
                                        <div className="flex items-center gap-1 mt-1 text-xs text-slate-600"><Calendar size={12} /> {calculateAge(item.purchaseDate)}</div>
                                        {item.receiptPdf && <div className="mt-1 flex items-center gap-1 text-[10px] text-orange-600"><FileIcon size={10}/> ‡∏°‡∏µ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à</div>}
                                    </div>
                                </div>
                            ))}
                            <div onClick={() => setView('add')} className="bg-slate-50 border-2 border-dashed border-slate-300 rounded-xl p-4 flex flex-col items-center justify-center text-slate-400 hover:border-blue-400 hover:text-blue-500 hover:bg-blue-50 transition cursor-pointer min-h-[120px]"><Plus size={32} className="mb-2"/><span className="text-sm font-medium">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span></div>
                        </div>
                    </div>
                );
            };

            const AddView = () => {
                const defaultLocation = departmentList.includes(selectedDepartment) ? selectedDepartment : '';
                const [formData, setFormData] = useState({
                    id: generateCode(),
                    name: '', model: '', purchaseDate: new Date().toISOString().split('T')[0],
                    location: defaultLocation, image: null, receiptPdf: null, status: 'active', history: []
                });

                const handleFileChange = async (e, field) => {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            const base64 = await fileToBase64(file);
                            setFormData({ ...formData, [field]: base64 });
                        } catch (err) {
                            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå");
                        }
                    }
                };

                return (
                    <div className="animate-fade-in max-w-2xl mx-auto pb-10">
                        <button onClick={() => setView('departments')} className="text-slate-500 mb-4 flex items-center gap-1 hover:text-slate-700"><ChevronLeft size={20} /> ‡∏Å‡∏•‡∏±‡∏ö</button>
                        <div className="bg-white p-6 rounded-xl shadow-md border border-slate-100">
                            <h2 className="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2"><Plus className="text-blue-600" /> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏´‡∏°‡πà</h2>
                            <form onSubmit={(e) => { e.preventDefault(); handleAddItem(formData); }} className="space-y-4">
                                <div className="flex justify-center mb-6">
                                    <div className="relative">
                                        <div className="w-32 h-32 bg-slate-100 rounded-xl border-2 border-dashed border-slate-300 flex items-center justify-center overflow-hidden">
                                            {formData.image ? <img src={formData.image} className="w-full h-full object-cover" /> : <div className="text-center text-slate-400"><Camera size={32} className="mx-auto mb-1" /><span className="text-xs">‡∏£‡∏π‡∏õ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span></div>}
                                        </div>
                                        <input type="file" accept="image/*" onChange={(e) => handleFileChange(e, 'image')} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                                    </div>
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">‡∏£‡∏´‡∏±‡∏™</label><input type="text" value={formData.id} readOnly className="w-full p-2 bg-slate-50 border rounded-lg font-mono text-slate-500" /></div>
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ã‡∏∑‡πâ‡∏≠</label><input type="date" value={formData.purchaseDate} onChange={e => setFormData({...formData, purchaseDate: e.target.value})} className="w-full p-2 border rounded-lg" /></div>
                                    <div className="md:col-span-2"><label className="block text-sm font-medium text-slate-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå *</label><input type="text" required value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} className="w-full p-2 border rounded-lg" /></div>
                                    <div><label className="block text-sm font-medium text-slate-700 mb-1">‡∏£‡∏∏‡πà‡∏ô</label><input type="text" value={formData.model} onChange={e => setFormData({...formData, model: e.target.value})} className="w-full p-2 border rounded-lg" /></div>
                                    <div>
                                        <label className="block text-sm font-medium text-slate-700 mb-1">‡πÅ‡∏ú‡∏ô‡∏Å *</label>
                                        <input type="text" required value={formData.location} onChange={e => setFormData({...formData, location: e.target.value})} className="w-full p-2 border rounded-lg" list="departments-list" />
                                        <datalist id="departments-list">{departmentList.map(d => <option key={d} value={d} />)}</datalist>
                                    </div>
                                    
                                    {/* Upload Receipt PDF */}
                                    <div className="md:col-span-2 bg-orange-50 p-4 rounded-lg border border-orange-100">
                                        <label className="block text-sm font-medium text-orange-800 mb-1 flex items-center gap-2"><FileIcon size={16}/> ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (PDF) - ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</label>
                                        <input type="file" accept="application/pdf" onChange={(e) => handleFileChange(e, 'receiptPdf')} className="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-100 file:text-orange-700 hover:file:bg-orange-200"/>
                                        {formData.receiptPdf && <p className="text-xs text-green-600 mt-1">‚úì ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡πâ‡∏ß</p>}
                                    </div>
                                </div>
                                <button type="submit" className="w-full mt-6 bg-blue-600 text-white py-3 rounded-lg font-semibold hover:bg-blue-700 shadow-md">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                            </form>
                        </div>
                    </div>
                );
            };

            const DetailView = () => {
                const item = selectedItem;
                const [activeTab, setActiveTab] = useState('history');
                const [newLog, setNewLog] = useState({ date: new Date().toISOString().split('T')[0], type: 'repair', description: '', laborCost: 0, parts: [] });
                const [tempPart, setTempPart] = useState({ name: '', supplier: '', price: '', image: null, receiptPdf: null });

                const handleTempPartFile = async (e, field) => {
                    const file = e.target.files[0];
                    if (file) {
                        const base64 = await fileToBase64(file);
                        setTempPart({ ...tempPart, [field]: base64 });
                    }
                };

                const addPartToLog = () => {
                    if (!tempPart.name) return;
                    setNewLog({ ...newLog, parts: [...newLog.parts, { ...tempPart, price: Number(tempPart.price) || 0 }] });
                    setTempPart({ name: '', supplier: '', price: '', image: null, receiptPdf: null });
                };

                const calculateTotal = () => Number(newLog.laborCost) + newLog.parts.reduce((sum, part) => sum + part.price, 0);

                const handleAddLog = (e) => {
                    e.preventDefault();
                    const logEntry = { id: Date.now(), ...newLog, laborCost: Number(newLog.laborCost), totalCost: calculateTotal() };
                    handleUpdateItem({ ...item, history: [logEntry, ...item.history] });
                    setActiveTab('history');
                    setNewLog({ date: new Date().toISOString().split('T')[0], type: 'repair', description: '', laborCost: 0, parts: [] });
                };

                return (
                    <div className="animate-fade-in max-w-5xl mx-auto pb-10">
                        <button onClick={() => setView('departmentItems')} className="text-slate-500 mb-4 flex items-center gap-1 hover:text-slate-700"><ChevronLeft size={20} /> ‡∏Å‡∏•‡∏±‡∏ö</button>
                        
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            {/* Left Column: Asset Info */}
                            <div className="md:col-span-1 space-y-4">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-100 overflow-hidden">
                                    <div className="h-48 bg-slate-200 flex items-center justify-center">
                                        {item.image ? <img src={item.image} className="w-full h-full object-cover" /> : <Camera size={48} className="text-slate-400" />}
                                    </div>
                                    <div className="p-4">
                                        <h2 className="text-lg font-bold text-slate-800">{item.name}</h2>
                                        <div className="text-sm text-slate-500 font-mono mb-2">{item.id}</div>
                                        <div className="space-y-2 text-sm text-slate-600 mt-4">
                                            <div className="flex justify-between"><span>‡∏£‡∏∏‡πà‡∏ô:</span> <span className="font-medium">{item.model || '-'}</span></div>
                                            <div className="flex justify-between"><span>‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà:</span> <span className="font-medium">{item.location}</span></div>
                                            {item.receiptPdf && (
                                                <div className="bg-orange-50 text-orange-700 p-2 rounded text-xs flex items-center gap-2 mt-2 border border-orange-100">
                                                    <FileIcon size={14}/> ‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏¢‡∏π‡πà
                                                </div>
                                            )}
                                        </div>
                                        
                                        <button onClick={() => syncToGoogle(item)} disabled={isSyncing} className="w-full mt-4 flex items-center justify-center gap-2 bg-green-600 text-white text-sm py-2 rounded-lg hover:bg-green-700 transition">
                                            {isSyncing ? <Loader2 className="animate-spin" size={16}/> : <UploadCloud size={16} />} 
                                            {isSyncing ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...' : 'Sync to Google'}
                                        </button>

                                        <button onClick={() => deleteItem(item.id)} className="w-full mt-2 flex items-center justify-center gap-2 text-red-500 hover:text-red-700 text-sm py-2 border border-red-100 rounded-lg hover:bg-red-50 transition"><Trash2 size={16} /> ‡∏•‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</button>
                                    </div>
                                </div>
                            </div>

                            {/* Right Column: History & Actions */}
                            <div className="md:col-span-2">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-100 min-h-[500px] flex flex-col">
                                    <div className="flex border-b border-slate-100">
                                        <button onClick={() => setActiveTab('history')} className={`flex-1 py-3 text-sm font-medium ${activeTab === 'history' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500'}`}>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ã‡πà‡∏≠‡∏°</button>
                                        <button onClick={() => setActiveTab('addLog')} className={`flex-1 py-3 text-sm font-medium ${activeTab === 'addLog' ? 'text-blue-600 border-b-2 border-blue-600' : 'text-slate-500'}`}>+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ã‡πà‡∏≠‡∏°/‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</button>
                                    </div>
                                    <div className="p-4 flex-1 overflow-y-auto">
                                        {activeTab === 'history' ? (
                                            <div className="space-y-6">
                                                {item.history.length === 0 ? <div className="text-center text-slate-400 py-10">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</div> : item.history.map(log => (
                                                    <div key={log.id} className="border-l-4 border-blue-500 pl-4 py-1 relative">
                                                        <div className="flex justify-between items-start mb-2">
                                                            <div><h4 className="font-bold text-slate-800">{log.description}</h4><div className="text-xs text-slate-400">{log.date} ({log.type})</div></div>
                                                            <div className="text-right font-bold text-blue-600">‡∏ø{log.totalCost?.toLocaleString()}</div>
                                                        </div>
                                                        {log.parts && log.parts.length > 0 && (
                                                            <div className="bg-slate-50 rounded p-2 text-sm space-y-2">
                                                                {log.parts.map((p, i) => (
                                                                    <div key={i} className="flex justify-between border-b border-slate-100 pb-1 last:border-0">
                                                                        <span className="flex items-center gap-1">{p.receiptPdf && <FileIcon size={10} className="text-orange-500"/>} {p.name}</span>
                                                                        <span className="text-slate-500">‡∏ø{p.price}</span>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        )}
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <form onSubmit={handleAddLog} className="space-y-4">
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div><label className="text-sm">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" required value={newLog.date} onChange={e => setNewLog({...newLog, date: e.target.value})} className="w-full p-2 border rounded" /></div>
                                                    <div><label className="text-sm">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select value={newLog.type} onChange={e => setNewLog({...newLog, type: e.target.value})} className="w-full p-2 border rounded"><option value="repair">‡∏ã‡πà‡∏≠‡∏°</option><option value="maintenance">‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤</option></select></div>
                                                </div>
                                                <div><label className="text-sm">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label><textarea required rows="2" value={newLog.description} onChange={e => setNewLog({...newLog, description: e.target.value})} className="w-full p-2 border rounded"></textarea></div>
                                                
                                                <div className="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                                    <label className="text-sm font-bold text-blue-800 mb-2 block">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà</label>
                                                    <div className="flex gap-2 mb-2">
                                                        <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏´‡∏•‡πà" className="flex-1 p-2 text-sm border rounded" value={tempPart.name} onChange={e => setTempPart({...tempPart, name: e.target.value})} />
                                                        <input type="number" placeholder="‡∏£‡∏≤‡∏Ñ‡∏≤" className="w-24 p-2 text-sm border rounded" value={tempPart.price} onChange={e => setTempPart({...tempPart, price: e.target.value})} />
                                                    </div>
                                                    <div className="grid grid-cols-2 gap-2 mb-2">
                                                        <input type="text" placeholder="‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤" className="p-2 text-sm border rounded" value={tempPart.supplier} onChange={e => setTempPart({...tempPart, supplier: e.target.value})} />
                                                        <div className="flex items-center gap-2">
                                                            <label className="cursor-pointer text-xs bg-white border px-2 py-2 rounded flex items-center gap-1 text-slate-500 hover:text-blue-600">
                                                                <Camera size={14}/> ‡∏£‡∏π‡∏õ
                                                                <input type="file" accept="image/*" className="hidden" onChange={(e) => handleTempPartFile(e, 'image')}/>
                                                            </label>
                                                            <label className="cursor-pointer text-xs bg-white border px-2 py-2 rounded flex items-center gap-1 text-slate-500 hover:text-orange-600">
                                                                <FileIcon size={14}/> ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à PDF
                                                                <input type="file" accept="application/pdf" className="hidden" onChange={(e) => handleTempPartFile(e, 'receiptPdf')}/>
                                                            </label>
                                                            <button type="button" onClick={addPartToLog} className="bg-blue-600 text-white px-3 py-1 rounded text-sm ml-auto">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                                                        </div>
                                                    </div>
                                                    {(tempPart.image || tempPart.receiptPdf) && <div className="text-[10px] text-green-600 mb-2">‡πÑ‡∏ü‡∏•‡πå‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î: {tempPart.image ? '‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ' : ''} {tempPart.receiptPdf ? 'PDF' : ''}</div>}
                                                    
                                                    {newLog.parts.length > 0 && <div className="space-y-1 bg-white p-2 rounded">{newLog.parts.map((p, i) => (
                                                        <div key={i} className="flex justify-between text-sm"><span className="flex items-center gap-1">{p.receiptPdf && <FileIcon size={10} className="text-orange-500"/>} {p.name}</span><span>‡∏ø{p.price}</span></div>
                                                    ))}</div>}
                                                </div>

                                                <div><label className="text-sm">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á</label><input type="number" value={newLog.laborCost} onChange={e => setNewLog({...newLog, laborCost: e.target.value})} className="w-full p-2 border rounded" /></div>
                                                <button type="submit" className="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 shadow-lg flex justify-center gap-2"><Save size={18} /> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                                            </form>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-900">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-10">
                        <div className="max-w-5xl mx-auto px-4 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3"><div className="bg-blue-600 text-white p-2 rounded-lg"><FileText size={24} /></div><div><h1 className="font-bold text-lg leading-tight">Asset Tracker</h1><p className="text-xs text-slate-500">‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå + Google Sync</p></div></div>
                            <div className="flex bg-slate-100 p-1 rounded-lg">
                                <button onClick={() => setView('dashboard')} className={`px-3 py-1.5 rounded-md text-sm font-medium transition ${view === 'dashboard' ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}><LayoutDashboard size={16} /></button>
                                <button onClick={() => setView('departments')} className={`px-3 py-1.5 rounded-md text-sm font-medium transition ${['departments', 'departmentItems', 'add', 'detail'].includes(view) ? 'bg-white shadow-sm text-blue-600' : 'text-slate-500'}`}><Building2 size={16} /></button>
                            </div>
                        </div>
                    </header>
                    <main className="max-w-5xl mx-auto px-4 pt-6">
                        {view === 'dashboard' && <DashboardView />}
                        {view === 'departments' && <DepartmentListView />}
                        {view === 'departmentItems' && <DepartmentItemsView />}
                        {view === 'add' && <AddView />}
                        {view === 'detail' && <DetailView />}
                    </main>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

